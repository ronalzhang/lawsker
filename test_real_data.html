<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•çœŸå®æ•°æ®è·å–</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .task-item { background: #f8f9fa; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
        .task-title { font-weight: bold; color: #333; }
        .task-meta { color: #666; font-size: 14px; margin: 5px 0; }
        .task-description { margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Lawsker çœŸå®æ•°æ®è·å–æµ‹è¯•</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ¼”ç¤ºæ¨¡å¼ä¸‹æ˜¯å¦èƒ½è·å–åˆ°çœŸå®çš„ä»»åŠ¡æ•°æ®</p>
    
    <h2>æµ‹è¯•ç»“æœ</h2>
    <div id="testResults"></div>
    
    <h2>è·å–åˆ°çš„ä»»åŠ¡æ•°æ®</h2>
    <div id="tasksContainer"></div>
    
    <h2>è¯¦ç»†æ—¥å¿—</h2>
    <pre id="detailLog"></pre>

    <script src="/js/api-client.js?v=1.4"></script>
    <script>
        let logs = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            document.getElementById('detailLog').textContent = logs.join('\n');
            console.log(logEntry);
        }
        
        function showResult(type, message) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('testResults').appendChild(div);
        }
        
        async function testApiClient() {
            log('å¼€å§‹æµ‹è¯• API å®¢æˆ·ç«¯...');
            
            try {
                // æ£€æŸ¥æ˜¯å¦ä¸ºæ¼”ç¤ºæ¨¡å¼
                log(`å½“å‰è·¯å¾„: ${window.location.pathname}`);
                log(`æ¼”ç¤ºæ¨¡å¼çŠ¶æ€: ${window.apiClient.isDemoMode}`);
                
                // æµ‹è¯•è·å–å¯ç”¨ä»»åŠ¡
                log('è°ƒç”¨ API è·å–å¯ç”¨ä»»åŠ¡...');
                const tasks = await window.apiClient.getAvailableTasks();
                
                if (Array.isArray(tasks)) {
                    showResult('success', `âœ… æˆåŠŸè·å–åˆ° ${tasks.length} ä¸ªä»»åŠ¡`);
                    log(`è·å–åˆ° ${tasks.length} ä¸ªä»»åŠ¡`);
                    
                    // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
                    const container = document.getElementById('tasksContainer');
                    if (tasks.length > 0) {
                        tasks.forEach((task, index) => {
                            const taskDiv = document.createElement('div');
                            taskDiv.className = 'task-item';
                            taskDiv.innerHTML = `
                                <div class="task-title">${task.title || 'æœªå‘½åä»»åŠ¡'}</div>
                                <div class="task-meta">
                                    ğŸ’° é¢„ç®—: Â¥${task.budget || task.amount || 'æœªçŸ¥'} | 
                                    â° ç´§æ€¥ç¨‹åº¦: ${task.urgency || 'æ™®é€š'} | 
                                    ğŸ“… å‘å¸ƒæ—¶é—´: ${task.created_at ? new Date(task.created_at).toLocaleString() : 'æœªçŸ¥'}
                                </div>
                                <div class="task-description">${task.description || 'æ— æè¿°'}</div>
                                <div class="task-meta">
                                    ğŸ‘¤ å‘å¸ƒè€…: ${task.publisher_name || 'åŒ¿å'} | 
                                    ğŸ·ï¸ ç±»å‹: ${task.task_type || 'æœªçŸ¥'}
                                </div>
                            `;
                            container.appendChild(taskDiv);
                        });
                        
                        // æ£€æŸ¥æ˜¯å¦æœ‰çœŸå®æ•°æ®çš„ç‰¹å¾
                        const hasRealData = tasks.some(task => 
                            task.task_id && 
                            !task.task_id.startsWith('demo-') &&
                            task.title && task.title.includes('æµ‹è¯•')
                        );
                        
                        if (hasRealData) {
                            showResult('success', 'âœ… æ£€æµ‹åˆ°çœŸå®æ•°æ®ï¼åŒ…å«æµ‹è¯•ä»»åŠ¡');
                            log('âœ… æˆåŠŸæ£€æµ‹åˆ°çœŸå®ä»»åŠ¡æ•°æ®');
                        } else {
                            showResult('error', 'âš ï¸ å¯èƒ½ä»ä¸ºæ¼”ç¤ºæ•°æ®');
                            log('âš ï¸ æœªæ£€æµ‹åˆ°çœŸå®æµ‹è¯•ä»»åŠ¡ï¼Œå¯èƒ½ä»ä¸ºæ¼”ç¤ºæ•°æ®');
                        }
                    } else {
                        showResult('error', 'âŒ è·å–åˆ°ç©ºä»»åŠ¡åˆ—è¡¨');
                        log('âŒ ä»»åŠ¡åˆ—è¡¨ä¸ºç©º');
                    }
                } else {
                    showResult('error', 'âŒ API è¿”å›æ ¼å¼å¼‚å¸¸');
                    log('âŒ API è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸');
                    log(`è¿”å›æ•°æ®: ${JSON.stringify(tasks)}`);
                }
                
            } catch (error) {
                showResult('error', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                log(`âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`);
                console.error('æµ‹è¯•å¼‚å¸¸:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            setTimeout(testApiClient, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿APIå®¢æˆ·ç«¯åˆå§‹åŒ–å®Œæˆ
        });
    </script>
</body>
</html>