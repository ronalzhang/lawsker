<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lawsker æ— éšœç¢è®¿é—®å¢å¼ºç‰ˆç®¡ç†åå°</title>
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/data-visualization.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        /* æ— éšœç¢è®¿é—®å¢å¼ºæ ·å¼ */
        :root {
            --focus-color: #2563eb;
            --focus-width: 3px;
            --high-contrast-bg: #000000;
            --high-contrast-text: #ffffff;
            --high-contrast-accent: #ffff00;
        }

        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼ */
        .high-contrast {
            --primary-color: #ffff00;
            --secondary-color: #00ffff;
            --success-color: #00ff00;
            --warning-color: #ff8800;
            --error-color: #ff0000;
            --gray-50: #ffffff;
            --gray-100: #ffffff;
            --gray-200: #ffffff;
            --gray-300: #cccccc;
            --gray-400: #999999;
            --gray-500: #666666;
            --gray-600: #333333;
            --gray-700: #000000;
            --gray-800: #000000;
            --gray-900: #000000;
            background: var(--high-contrast-bg) !important;
            color: var(--high-contrast-text) !important;
        }

        .high-contrast * {
            background-color: inherit !important;
            color: inherit !important;
            border-color: var(--high-contrast-accent) !important;
        }

        .high-contrast .analytics-card,
        .high-contrast .metric-item,
        .high-contrast .chart-card {
            background: #000000 !important;
            border: 2px solid #ffff00 !important;
            color: #ffffff !important;
        }

        /* ç„¦ç‚¹æŒ‡ç¤ºå™¨å¢å¼º */
        *:focus {
            outline: var(--focus-width) solid var(--focus-color);
            outline-offset: 2px;
            box-shadow: 0 0 0 var(--focus-width) rgba(37, 99, 235, 0.3);
        }

        .focus-visible {
            outline: var(--focus-width) solid var(--focus-color);
            outline-offset: 2px;
        }

        /* è·³è½¬é“¾æ¥ */
        .skip-links {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--focus-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            transition: top 0.3s;
        }

        .skip-links:focus {
            top: 6px;
        }

        /* å±å¹•é˜…è¯»å™¨ä¸“ç”¨æ–‡æœ¬ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* é”®ç›˜å¯¼èˆªå¢å¼º */
        .keyboard-nav-active .nav-tab:focus,
        .keyboard-nav-active .action-btn:focus,
        .keyboard-nav-active .export-btn:focus {
            transform: scale(1.05);
            z-index: 10;
        }

        /* åŠ¨ç”»å‡å°‘é€‰é¡¹ */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* å¤§å­—ä½“æ”¯æŒ */
        .large-text {
            font-size: 1.25em;
        }

        .large-text .metric-value {
            font-size: 3rem;
        }

        .large-text .chart-title {
            font-size: 1.5rem;
        }

        /* é¢œè‰²ç›²å‹å¥½ */
        .colorblind-friendly .chart-container {
            filter: none;
        }

        /* è¯­éŸ³æ§åˆ¶æ”¯æŒ */
        [data-voice-command] {
            position: relative;
        }

        [data-voice-command]::after {
            content: attr(data-voice-command);
            position: absolute;
            top: -20px;
            left: 0;
            font-size: 0.75rem;
            color: #666;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .voice-commands-visible [data-voice-command]::after {
            opacity: 1;
        }

        /* æ— éšœç¢å·¥å…·æ  */
        .accessibility-toolbar {
            position: fixed;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 1rem;
            border-radius: 0 0 0 1rem;
            z-index: 1001;
            display: flex;
            gap: 0.5rem;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .accessibility-toolbar.show {
            transform: translateY(0);
        }

        .accessibility-btn {
            padding: 0.5rem;
            background: transparent;
            border: 1px solid white;
            color: white;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .accessibility-btn:hover,
        .accessibility-btn:focus {
            background: white;
            color: black;
        }

        .accessibility-btn.active {
            background: #ffff00;
            color: black;
            border-color: #ffff00;
        }

        /* å®æ—¶å­—å¹•åŒºåŸŸ */
        .live-captions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 1rem 2rem;
            border-radius: 2rem;
            max-width: 80%;
            text-align: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .live-captions.show {
            opacity: 1;
            visibility: visible;
        }

        /* é”®ç›˜å¿«æ·é”®æç¤º */
        .keyboard-shortcuts {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1002;
            max-width: 500px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .keyboard-shortcuts.show {
            opacity: 1;
            visibility: visible;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .shortcut-key {
            background: #f3f4f6;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-family: monospace;
            font-weight: bold;
        }

        /* è¯­éŸ³åé¦ˆçŠ¶æ€ */
        .voice-feedback-active {
            border: 2px dashed #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* è§¦æ‘¸å‹å¥½çš„æŒ‰é’® */
        @media (pointer: coarse) {
            .action-btn,
            .export-btn,
            .nav-tab {
                min-height: 44px;
                min-width: 44px;
                padding: 0.75rem 1.5rem;
            }
        }

        /* é”™è¯¯å’ŒæˆåŠŸçŠ¶æ€çš„æ— éšœç¢å¢å¼º */
        .error-state {
            border-left: 4px solid #dc2626;
            background: #fef2f2;
            color: #991b1b;
        }

        .success-state {
            border-left: 4px solid #059669;
            background: #f0fdf4;
            color: #065f46;
        }

        .warning-state {
            border-left: 4px solid #d97706;
            background: #fffbeb;
            color: #92400e;
        }

        /* æ•°æ®è¡¨æ ¼æ— éšœç¢å¢å¼º */
        .accessible-table {
            border-collapse: separate;
            border-spacing: 0;
        }

        .accessible-table th {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .accessible-table th[aria-sort] {
            cursor: pointer;
            user-select: none;
        }

        .accessible-table th[aria-sort="ascending"]::after {
            content: " â†‘";
        }

        .accessible-table th[aria-sort="descending"]::after {
            content: " â†“";
        }

        .accessible-table tr:nth-child(even) {
            background: #f9fafb;
        }

        .accessible-table tr:hover,
        .accessible-table tr:focus-within {
            background: #e5e7eb;
            outline: 2px solid var(--focus-color);
        }
    </style>
</head>
<body>
    <!-- è·³è½¬é“¾æ¥ -->
    <a href="#main-content" class="skip-links">è·³è½¬åˆ°ä¸»è¦å†…å®¹</a>
    <a href="#navigation" class="skip-links">è·³è½¬åˆ°å¯¼èˆª</a>

    <!-- æ— éšœç¢å·¥å…·æ  -->
    <div class="accessibility-toolbar" id="accessibilityToolbar">
        <button class="accessibility-btn" onclick="toggleHighContrast()" 
                aria-label="åˆ‡æ¢é«˜å¯¹æ¯”åº¦æ¨¡å¼" title="åˆ‡æ¢é«˜å¯¹æ¯”åº¦æ¨¡å¼">
            <span aria-hidden="true">ğŸ¨</span>
        </button>
        <button class="accessibility-btn" onclick="toggleLargeText()" 
                aria-label="åˆ‡æ¢å¤§å­—ä½“æ¨¡å¼" title="åˆ‡æ¢å¤§å­—ä½“æ¨¡å¼">
            <span aria-hidden="true">ğŸ”</span>
        </button>
        <button class="accessibility-btn" onclick="toggleKeyboardShortcuts()" 
                aria-label="æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®" title="æ˜¾ç¤ºé”®ç›˜å¿«æ·é”®">
            <span aria-hidden="true">âŒ¨ï¸</span>
        </button>
        <button class="accessibility-btn" onclick="toggleVoiceCommands()" 
                aria-label="å¯ç”¨è¯­éŸ³å‘½ä»¤" title="å¯ç”¨è¯­éŸ³å‘½ä»¤">
            <span aria-hidden="true">ğŸ¤</span>
        </button>
        <button class="accessibility-btn" onclick="toggleReducedMotion()" 
                aria-label="å‡å°‘åŠ¨ç”»æ•ˆæœ" title="å‡å°‘åŠ¨ç”»æ•ˆæœ">
            <span aria-hidden="true">â¸ï¸</span>
        </button>
    </div>

    <!-- å®æ—¶å­—å¹• -->
    <div class="live-captions" id="liveCaptions" role="status" aria-live="polite">
        <span id="captionText"></span>
    </div>

    <!-- é”®ç›˜å¿«æ·é”®å¸®åŠ© -->
    <div class="keyboard-shortcuts" id="keyboardShortcuts" role="dialog" aria-labelledby="shortcuts-title">
        <h3 id="shortcuts-title">é”®ç›˜å¿«æ·é”®</h3>
        <div class="shortcut-item">
            <span>æ˜¾ç¤º/éšè—æ— éšœç¢å·¥å…·æ </span>
            <kbd class="shortcut-key">Alt + A</kbd>
        </div>
        <div class="shortcut-item">
            <span>åˆ‡æ¢é«˜å¯¹æ¯”åº¦æ¨¡å¼</span>
            <kbd class="shortcut-key">Alt + C</kbd>
        </div>
        <div class="shortcut-item">
            <span>åˆ‡æ¢å¤§å­—ä½“æ¨¡å¼</span>
            <kbd class="shortcut-key">Alt + L</kbd>
        </div>
        <div class="shortcut-item">
            <span>åˆ·æ–°æ•°æ®</span>
            <kbd class="shortcut-key">Alt + R</kbd>
        </div>
        <div class="shortcut-item">
            <span>å¯¼å‡ºæ•°æ®</span>
            <kbd class="shortcut-key">Alt + E</kbd>
        </div>
        <div class="shortcut-item">
            <span>æœç´¢</span>
            <kbd class="shortcut-key">Alt + S</kbd>
        </div>
        <div class="shortcut-item">
            <span>å…³é—­æ­¤å¯¹è¯æ¡†</span>
            <kbd class="shortcut-key">Escape</kbd>
        </div>
        <button onclick="toggleKeyboardShortcuts()" style="margin-top: 1rem; padding: 0.5rem 1rem; border: 1px solid #ccc; background: white; border-radius: 0.25rem;">å…³é—­</button>
    </div>

    <div class="analytics-container" id="mainContainer">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="analytics-header">
            <h1 class="analytics-title">
                <span class="sr-only">Lawsker æ•°æ®åˆ†æä¸­å¿ƒ - </span>
                æ— éšœç¢å¢å¼ºç‰ˆç®¡ç†åå°
            </h1>
            <p class="analytics-subtitle">åŸºäºæ•°æ®é©±åŠ¨çš„æ™ºèƒ½å†³ç­–æ”¯æŒç³»ç»Ÿï¼Œæ”¯æŒå®Œæ•´çš„æ— éšœç¢è®¿é—®</p>
            
            <nav id="navigation" class="analytics-nav" role="navigation" aria-label="ä¸»å¯¼èˆª">
                <a href="#overview" class="nav-tab active" 
                   data-voice-command="æ€»è§ˆ" 
                   aria-current="page"
                   role="tab"
                   aria-selected="true">
                    <i data-feather="bar-chart-2" aria-hidden="true"></i>
                    <span>æ€»è§ˆ</span>
                </a>
                <a href="#users" class="nav-tab" 
                   data-voice-command="ç”¨æˆ·åˆ†æ"
                   role="tab"
                   aria-selected="false">
                    <i data-feather="users" aria-hidden="true"></i>
                    <span>ç”¨æˆ·åˆ†æ</span>
                </a>
                <a href="#lawyers" class="nav-tab" 
                   data-voice-command="å¾‹å¸ˆåˆ†æ"
                   role="tab"
                   aria-selected="false">
                    <i data-feather="briefcase" aria-hidden="true"></i>
                    <span>å¾‹å¸ˆåˆ†æ</span>
                </a>
                <a href="#business" class="nav-tab" 
                   data-voice-command="ä¸šåŠ¡åˆ†æ"
                   role="tab"
                   aria-selected="false">
                    <i data-feather="trending-up" aria-hidden="true"></i>
                    <span>ä¸šåŠ¡åˆ†æ</span>
                </a>
            </nav>
        </header>

        <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
        <section class="metric-grid" role="region" aria-labelledby="metrics-title">
            <h2 id="metrics-title" class="sr-only">æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡</h2>
            
            <div class="metric-item" role="img" aria-labelledby="total-users-label" aria-describedby="total-users-desc">
                <div class="metric-value" id="totalUsers" aria-live="polite">15,847</div>
                <div class="metric-label" id="total-users-label">æ€»ç”¨æˆ·æ•°</div>
                <div class="metric-change positive" id="total-users-desc">
                    <i data-feather="trending-up" aria-hidden="true"></i>
                    <span>è¾ƒä¸Šæœˆå¢é•¿12.5%</span>
                </div>
            </div>

            <div class="metric-item" role="img" aria-labelledby="active-lawyers-label" aria-describedby="active-lawyers-desc">
                <div class="metric-value" id="activeLawyers" aria-live="polite">3,256</div>
                <div class="metric-label" id="active-lawyers-label">æ´»è·ƒå¾‹å¸ˆ</div>
                <div class="metric-change positive" id="active-lawyers-desc">
                    <i data-feather="trending-up" aria-hidden="true"></i>
                    <span>è¾ƒä¸Šæœˆå¢é•¿8.3%</span>
                </div>
            </div>

            <div class="metric-item" role="img" aria-labelledby="completed-cases-label" aria-describedby="completed-cases-desc">
                <div class="metric-value" id="completedCases" aria-live="polite">12,924</div>
                <div class="metric-label" id="completed-cases-label">å®Œæˆæ¡ˆä»¶</div>
                <div class="metric-change positive" id="completed-cases-desc">
                    <i data-feather="trending-up" aria-hidden="true"></i>
                    <span>è¾ƒä¸Šæœˆå¢é•¿15.7%</span>
                </div>
            </div>

            <div class="metric-item" role="img" aria-labelledby="monthly-revenue-label" aria-describedby="monthly-revenue-desc">
                <div class="metric-value" id="monthlyRevenue" aria-live="polite">Â¥2,847,890</div>
                <div class="metric-label" id="monthly-revenue-label">æœˆåº¦æ”¶å…¥</div>
                <div class="metric-change positive" id="monthly-revenue-desc">
                    <i data-feather="trending-up" aria-hidden="true"></i>
                    <span>è¾ƒä¸Šæœˆå¢é•¿22.1%</span>
                </div>
            </div>
        </section>

        <!-- å›¾è¡¨ä»ªè¡¨ç›˜ -->
        <main id="main-content" class="dashboard-grid" role="main">
            <!-- ç”¨æˆ·å¢é•¿è¶‹åŠ¿ -->
            <section class="analytics-card" role="region" aria-labelledby="user-growth-title">
                <div class="card-header">
                    <h3 class="card-title" id="user-growth-title">
                        <div class="card-icon" aria-hidden="true">
                            <i data-feather="users"></i>
                        </div>
                        ç”¨æˆ·å¢é•¿è¶‹åŠ¿
                    </h3>
                    <div class="card-actions">
                        <button class="action-btn" 
                                onclick="refreshChart('userGrowthChart')" 
                                aria-label="åˆ·æ–°ç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾è¡¨"
                                data-voice-command="åˆ·æ–°ç”¨æˆ·å›¾è¡¨">
                            <i data-feather="refresh-cw" aria-hidden="true"></i>
                            <span class="sr-only">åˆ·æ–°</span>
                        </button>
                        <button class="action-btn" 
                                onclick="exportChart('userGrowthChart')" 
                                aria-label="å¯¼å‡ºç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾è¡¨"
                                data-voice-command="å¯¼å‡ºç”¨æˆ·å›¾è¡¨">
                            <i data-feather="download" aria-hidden="true"></i>
                            <span class="sr-only">å¯¼å‡º</span>
                        </button>
                    </div>
                </div>
                <div class="chart-container" 
                     id="userGrowthChart" 
                     role="img" 
                     aria-label="ç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾è¡¨ï¼Œæ˜¾ç¤ºè¿‡å»12ä¸ªæœˆçš„æ–°å¢ç”¨æˆ·å’Œæ´»è·ƒç”¨æˆ·æ•°æ®"
                     tabindex="0">
                </div>
            </section>

            <!-- å¾‹å¸ˆç­‰çº§åˆ†å¸ƒ -->
            <section class="analytics-card" role="region" aria-labelledby="lawyer-level-title">
                <div class="card-header">
                    <h3 class="card-title" id="lawyer-level-title">
                        <div class="card-icon" aria-hidden="true" style="background: var(--secondary-gradient);">
                            <i data-feather="award"></i>
                        </div>
                        å¾‹å¸ˆç­‰çº§åˆ†å¸ƒ
                    </h3>
                    <div class="card-actions">
                        <button class="action-btn" 
                                onclick="refreshChart('lawyerLevelChart')" 
                                aria-label="åˆ·æ–°å¾‹å¸ˆç­‰çº§åˆ†å¸ƒå›¾è¡¨"
                                data-voice-command="åˆ·æ–°å¾‹å¸ˆå›¾è¡¨">
                            <i data-feather="refresh-cw" aria-hidden="true"></i>
                            <span class="sr-only">åˆ·æ–°</span>
                        </button>
                        <button class="action-btn" 
                                onclick="exportChart('lawyerLevelChart')" 
                                aria-label="å¯¼å‡ºå¾‹å¸ˆç­‰çº§åˆ†å¸ƒå›¾è¡¨"
                                data-voice-command="å¯¼å‡ºå¾‹å¸ˆå›¾è¡¨">
                            <i data-feather="download" aria-hidden="true"></i>
                            <span class="sr-only">å¯¼å‡º</span>
                        </button>
                    </div>
                </div>
                <div class="chart-container" 
                     id="lawyerLevelChart" 
                     role="img" 
                     aria-label="å¾‹å¸ˆç­‰çº§åˆ†å¸ƒé¥¼å›¾ï¼Œæ˜¾ç¤ºä»è§ä¹ å¾‹å¸ˆåˆ°åˆä¼™äººå„ç­‰çº§çš„äººæ•°åˆ†å¸ƒ"
                     tabindex="0">
                </div>
            </section>
        </main>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <section class="data-table-card" role="region" aria-labelledby="user-activity-title">
            <div class="table-header">
                <h3 class="chart-title" id="user-activity-title">æœ€æ–°ç”¨æˆ·æ´»åŠ¨</h3>
                <div class="search-box" role="search">
                    <label for="userSearch" class="sr-only">æœç´¢ç”¨æˆ·</label>
                    <i data-feather="search" aria-hidden="true"></i>
                    <input type="text" 
                           placeholder="æœç´¢ç”¨æˆ·..." 
                           id="userSearch"
                           aria-describedby="search-help">
                    <div id="search-help" class="sr-only">è¾“å…¥ç”¨æˆ·åã€IDæˆ–ç±»å‹è¿›è¡Œæœç´¢</div>
                </div>
            </div>
            <div style="overflow-x: auto;" role="region" aria-label="ç”¨æˆ·æ´»åŠ¨æ•°æ®è¡¨æ ¼" tabindex="0">
                <table class="data-table accessible-table" role="table" aria-labelledby="user-activity-title">
                    <thead>
                        <tr role="row">
                            <th role="columnheader" aria-sort="none" tabindex="0">ç”¨æˆ·ID</th>
                            <th role="columnheader" aria-sort="none" tabindex="0">ç”¨æˆ·å</th>
                            <th role="columnheader" aria-sort="none" tabindex="0">ç”¨æˆ·ç±»å‹</th>
                            <th role="columnheader" aria-sort="none" tabindex="0">æ³¨å†Œæ—¶é—´</th>
                            <th role="columnheader" aria-sort="none" tabindex="0">æœ€åæ´»åŠ¨</th>
                            <th role="columnheader" aria-sort="none" tabindex="0">çŠ¶æ€</th>
                            <th role="columnheader">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody" role="rowgroup">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„ç”¨æˆ·æ•°æ® -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        // æ— éšœç¢è®¿é—®åŠŸèƒ½
        let isHighContrast = false;
        let isLargeText = false;
        let isKeyboardNavActive = false;
        let isVoiceCommandsActive = false;
        let isReducedMotion = false;

        // åˆå§‹åŒ–æ— éšœç¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            feather.replace();
            initializeAccessibility();
            initializeCharts();
            loadUserTable();
            setupKeyboardNavigation();
            setupVoiceCommands();
            setupScreenReader();
        });

        function initializeAccessibility() {
            // æ£€æµ‹ç”¨æˆ·åå¥½
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                isReducedMotion = true;
                document.body.classList.add('reduced-motion');
            }

            if (window.matchMedia('(prefers-contrast: high)').matches) {
                toggleHighContrast();
            }

            // æ˜¾ç¤ºæ— éšœç¢å·¥å…·æ 
            setTimeout(() => {
                document.getElementById('accessibilityToolbar').classList.add('show');
            }, 1000);

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', handleKeyboardShortcuts);

            // ç„¦ç‚¹ç®¡ç†
            document.addEventListener('focusin', handleFocusIn);
            document.addEventListener('focusout', handleFocusOut);
        }

        function handleKeyboardShortcuts(e) {
            if (e.altKey) {
                switch(e.key) {
                    case 'a':
                    case 'A':
                        e.preventDefault();
                        toggleAccessibilityToolbar();
                        break;
                    case 'c':
                    case 'C':
                        e.preventDefault();
                        toggleHighContrast();
                        break;
                    case 'l':
                    case 'L':
                        e.preventDefault();
                        toggleLargeText();
                        break;
                    case 'r':
                    case 'R':
                        e.preventDefault();
                        refreshAllCharts();
                        break;
                    case 'e':
                    case 'E':
                        e.preventDefault();
                        exportAllData();
                        break;
                    case 's':
                    case 'S':
                        e.preventDefault();
                        document.getElementById('userSearch').focus();
                        break;
                }
            }

            if (e.key === 'Escape') {
                closeAllDialogs();
            }
        }

        function handleFocusIn(e) {
            if (e.target.matches('button, a, input, select, textarea, [tabindex]')) {
                e.target.classList.add('focus-visible');
                announceToScreenReader(`ç„¦ç‚¹åœ¨ ${getFocusDescription(e.target)}`);
            }
        }

        function handleFocusOut(e) {
            e.target.classList.remove('focus-visible');
        }

        function getFocusDescription(element) {
            return element.getAttribute('aria-label') || 
                   element.getAttribute('title') || 
                   element.textContent.trim() || 
                   element.tagName;
        }

        function toggleAccessibilityToolbar() {
            const toolbar = document.getElementById('accessibilityToolbar');
            toolbar.classList.toggle('show');
        }

        function toggleHighContrast() {
            isHighContrast = !isHighContrast;
            document.body.classList.toggle('high-contrast', isHighContrast);
            
            const btn = event?.target?.closest('.accessibility-btn');
            if (btn) {
                btn.classList.toggle('active', isHighContrast);
            }

            announceToScreenReader(isHighContrast ? 'å·²å¯ç”¨é«˜å¯¹æ¯”åº¦æ¨¡å¼' : 'å·²å…³é—­é«˜å¯¹æ¯”åº¦æ¨¡å¼');
            showLiveCaptions(isHighContrast ? 'é«˜å¯¹æ¯”åº¦æ¨¡å¼å·²å¯ç”¨' : 'é«˜å¯¹æ¯”åº¦æ¨¡å¼å·²å…³é—­');
        }

        function toggleLargeText() {
            isLargeText = !isLargeText;
            document.body.classList.toggle('large-text', isLargeText);
            
            const btn = event?.target?.closest('.accessibility-btn');
            if (btn) {
                btn.classList.toggle('active', isLargeText);
            }

            announceToScreenReader(isLargeText ? 'å·²å¯ç”¨å¤§å­—ä½“æ¨¡å¼' : 'å·²å…³é—­å¤§å­—ä½“æ¨¡å¼');
            showLiveCaptions(isLargeText ? 'å¤§å­—ä½“æ¨¡å¼å·²å¯ç”¨' : 'å¤§å­—ä½“æ¨¡å¼å·²å…³é—­');
        }

        function toggleKeyboardShortcuts() {
            const dialog = document.getElementById('keyboardShortcuts');
            dialog.classList.toggle('show');
            
            if (dialog.classList.contains('show')) {
                dialog.focus();
                announceToScreenReader('é”®ç›˜å¿«æ·é”®å¸®åŠ©å·²æ‰“å¼€');
            } else {
                announceToScreenReader('é”®ç›˜å¿«æ·é”®å¸®åŠ©å·²å…³é—­');
            }
        }

        function toggleVoiceCommands() {
            isVoiceCommandsActive = !isVoiceCommandsActive;
            document.body.classList.toggle('voice-commands-visible', isVoiceCommandsActive);
            
            const btn = event?.target?.closest('.accessibility-btn');
            if (btn) {
                btn.classList.toggle('active', isVoiceCommandsActive);
            }

            if (isVoiceCommandsActive) {
                startVoiceRecognition();
                announceToScreenReader('è¯­éŸ³å‘½ä»¤å·²å¯ç”¨');
                showLiveCaptions('è¯­éŸ³å‘½ä»¤å·²å¯ç”¨ï¼Œè¯·è¯´å‡ºå‘½ä»¤');
            } else {
                stopVoiceRecognition();
                announceToScreenReader('è¯­éŸ³å‘½ä»¤å·²å…³é—­');
                showLiveCaptions('è¯­éŸ³å‘½ä»¤å·²å…³é—­');
            }
        }

        function toggleReducedMotion() {
            isReducedMotion = !isReducedMotion;
            document.body.classList.toggle('reduced-motion', isReducedMotion);
            
            const btn = event?.target?.closest('.accessibility-btn');
            if (btn) {
                btn.classList.toggle('active', isReducedMotion);
            }

            announceToScreenReader(isReducedMotion ? 'å·²å‡å°‘åŠ¨ç”»æ•ˆæœ' : 'å·²æ¢å¤åŠ¨ç”»æ•ˆæœ');
            showLiveCaptions(isReducedMotion ? 'åŠ¨ç”»æ•ˆæœå·²å‡å°‘' : 'åŠ¨ç”»æ•ˆæœå·²æ¢å¤');
        }

        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        function showLiveCaptions(message) {
            const captions = document.getElementById('liveCaptions');
            const captionText = document.getElementById('captionText');
            
            captionText.textContent = message;
            captions.classList.add('show');
            
            setTimeout(() => {
                captions.classList.remove('show');
            }, 3000);
        }

        function setupKeyboardNavigation() {
            // Tabé”®å¯¼èˆªå¢å¼º
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    document.body.classList.add('keyboard-nav-active');
                }
            });

            document.addEventListener('mousedown', function() {
                document.body.classList.remove('keyboard-nav-active');
            });

            // æ–¹å‘é”®å¯¼èˆª
            document.addEventListener('keydown', function(e) {
                if (e.target.matches('.nav-tab')) {
                    const tabs = Array.from(document.querySelectorAll('.nav-tab'));
                    const currentIndex = tabs.indexOf(e.target);
                    
                    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        const nextIndex = (currentIndex + 1) % tabs.length;
                        tabs[nextIndex].focus();
                    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                        e.preventDefault();
                        const prevIndex = (currentIndex - 1 + tabs.length) % tabs.length;
                        tabs[prevIndex].focus();
                    }
                }
            });
        }

        function setupVoiceCommands() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                window.recognition = new SpeechRecognition();
                
                window.recognition.continuous = true;
                window.recognition.interimResults = true;
                window.recognition.lang = 'zh-CN';
                
                window.recognition.onresult = function(event) {
                    const command = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
                    handleVoiceCommand(command);
                };
                
                window.recognition.onerror = function(event) {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    showLiveCaptions('è¯­éŸ³è¯†åˆ«å‡ºé”™ï¼Œè¯·é‡è¯•');
                };
            }
        }

        function startVoiceRecognition() {
            if (window.recognition) {
                window.recognition.start();
                document.body.classList.add('voice-feedback-active');
            }
        }

        function stopVoiceRecognition() {
            if (window.recognition) {
                window.recognition.stop();
                document.body.classList.remove('voice-feedback-active');
            }
        }

        function handleVoiceCommand(command) {
            showLiveCaptions(`è¯†åˆ«åˆ°å‘½ä»¤: ${command}`);
            
            if (command.includes('æ€»è§ˆ') || command.includes('æ¦‚è§ˆ')) {
                document.querySelector('[data-voice-command="æ€»è§ˆ"]').click();
            } else if (command.includes('ç”¨æˆ·åˆ†æ') || command.includes('ç”¨æˆ·')) {
                document.querySelector('[data-voice-command="ç”¨æˆ·åˆ†æ"]').click();
            } else if (command.includes('å¾‹å¸ˆåˆ†æ') || command.includes('å¾‹å¸ˆ')) {
                document.querySelector('[data-voice-command="å¾‹å¸ˆåˆ†æ"]').click();
            } else if (command.includes('ä¸šåŠ¡åˆ†æ') || command.includes('ä¸šåŠ¡')) {
                document.querySelector('[data-voice-command="ä¸šåŠ¡åˆ†æ"]').click();
            } else if (command.includes('åˆ·æ–°')) {
                refreshAllCharts();
            } else if (command.includes('å¯¼å‡º')) {
                exportAllData();
            } else if (command.includes('æœç´¢')) {
                document.getElementById('userSearch').focus();
            } else {
                showLiveCaptions('æœªè¯†åˆ«çš„å‘½ä»¤ï¼Œè¯·é‡è¯•');
            }
        }

        function setupScreenReader() {
            // ä¸ºå›¾è¡¨æ·»åŠ è¯¦ç»†æè¿°
            setTimeout(() => {
                const charts = document.querySelectorAll('.chart-container');
                charts.forEach(chart => {
                    chart.addEventListener('focus', function() {
                        const description = this.getAttribute('aria-label');
                        announceToScreenReader(description);
                    });
                });
            }, 2000);
        }

        function closeAllDialogs() {
            document.getElementById('keyboardShortcuts').classList.remove('show');
            document.getElementById('liveCaptions').classList.remove('show');
        }

        function refreshAllCharts() {
            announceToScreenReader('æ­£åœ¨åˆ·æ–°æ‰€æœ‰å›¾è¡¨');
            showLiveCaptions('æ­£åœ¨åˆ·æ–°æ•°æ®...');
            
            // æ¨¡æ‹Ÿåˆ·æ–°
            setTimeout(() => {
                announceToScreenReader('æ‰€æœ‰å›¾è¡¨å·²åˆ·æ–°å®Œæˆ');
                showLiveCaptions('æ•°æ®åˆ·æ–°å®Œæˆ');
            }, 2000);
        }

        function exportAllData() {
            announceToScreenReader('æ­£åœ¨å¯¼å‡ºæ‰€æœ‰æ•°æ®');
            showLiveCaptions('æ­£åœ¨å¯¼å‡ºæ•°æ®...');
            
            // æ¨¡æ‹Ÿå¯¼å‡º
            setTimeout(() => {
                announceToScreenReader('æ•°æ®å¯¼å‡ºå®Œæˆ');
                showLiveCaptions('æ•°æ®å¯¼å‡ºå®Œæˆ');
            }, 1500);
        }

        // å›¾è¡¨åˆå§‹åŒ–ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function initializeCharts() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ å›¾è¡¨åˆå§‹åŒ–ä»£ç 
            console.log('å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        function loadUserTable() {
            const tableBody = document.getElementById('userTableBody');
            const users = [
                {id: 'U001', name: 'å¼ ä¸‰', type: 'æ™®é€šç”¨æˆ·', registerTime: '2024-01-15', lastActive: '2024-01-20', status: 'active'},
                {id: 'L001', name: 'æå¾‹å¸ˆ', type: 'å¾‹å¸ˆç”¨æˆ·', registerTime: '2024-01-10', lastActive: '2024-01-20', status: 'active'},
                {id: 'U002', name: 'ç‹äº”', type: 'æ™®é€šç”¨æˆ·', registerTime: '2024-01-18', lastActive: '2024-01-19', status: 'pending'}
            ];

            tableBody.innerHTML = users.map((user, index) => `
                <tr role="row" tabindex="0" aria-rowindex="${index + 2}">
                    <td role="gridcell">${user.id}</td>
                    <td role="gridcell">${user.name}</td>
                    <td role="gridcell">${user.type}</td>
                    <td role="gridcell">${user.registerTime}</td>
                    <td role="gridcell">${user.lastActive}</td>
                    <td role="gridcell">
                        <span class="status-badge status-${user.status}" role="status">
                            ${user.status === 'active' ? 'æ´»è·ƒ' : user.status === 'pending' ? 'å¾…å®¡æ ¸' : 'éæ´»è·ƒ'}
                        </span>
                    </td>
                    <td role="gridcell">
                        <button onclick="viewUser('${user.id}')" 
                                aria-label="æŸ¥çœ‹ç”¨æˆ· ${user.name} çš„è¯¦ç»†ä¿¡æ¯"
                                style="padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; background: white; border-radius: 0.25rem; cursor: pointer;">
                            æŸ¥çœ‹
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function viewUser(userId) {
            announceToScreenReader(`æ­£åœ¨æŸ¥çœ‹ç”¨æˆ· ${userId} çš„è¯¦ç»†ä¿¡æ¯`);
            showLiveCaptions(`æŸ¥çœ‹ç”¨æˆ· ${userId}`);
        }

        // æœç´¢åŠŸèƒ½å¢å¼º
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('userSearch');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#userTableBody tr');
                    let visibleCount = 0;
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        const isVisible = text.includes(searchTerm);
                        row.style.display = isVisible ? '' : 'none';
                        if (isVisible) visibleCount++;
                    });
                    
                    announceToScreenReader(`æœç´¢ç»“æœï¼šæ‰¾åˆ° ${visibleCount} æ¡åŒ¹é…è®°å½•`);
                });
            }
        });
    </script>
</body>
</html>