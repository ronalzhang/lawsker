<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2563eb">
    <title>ç§»åŠ¨ç«¯æ€§èƒ½æµ‹è¯• - Lawsker</title>
    
    <!-- å“åº”å¼è®¾è®¡ç³»ç»Ÿ -->
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/responsive-enhanced.css">
    
    <style>
        .performance-test-container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: var(--bg-primary);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .test-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            margin-bottom: 16px;
            color: var(--color-primary);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }
        
        .metric-card {
            background: var(--gray-50);
            padding: 16px;
            border-radius: var(--radius-lg);
            text-align: center;
        }
        
        .metric-value {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--color-primary);
            display: block;
        }
        
        .metric-label {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .test-button {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            margin: 8px;
            min-height: var(--touch-target-min);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .test-button:active {
            transform: scale(0.98);
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: 16px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-500), var(--secondary-500));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .test-log {
            background: var(--gray-900);
            color: var(--gray-100);
            padding: 16px;
            border-radius: var(--radius-lg);
            font-family: var(--font-family-mono);
            font-size: var(--text-sm);
            max-height: 200px;
            overflow-y: auto;
            margin-top: 16px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: var(--success-500); }
        .status-warning { background: var(--warning-500); }
        .status-error { background: var(--error-500); }
        
        .touch-test-area {
            background: var(--primary-50);
            border: 2px dashed var(--primary-300);
            border-radius: var(--radius-xl);
            padding: 40px;
            text-align: center;
            margin: 16px 0;
            user-select: none;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .touch-test-area.active {
            background: var(--primary-100);
            border-color: var(--primary-500);
            transform: scale(0.98);
        }
        
        @media (max-width: 768px) {
            .performance-test-container {
                padding: 16px;
            }
            
            .test-section {
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .metric-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="performance-test-container">
        <header class="test-section">
            <h1 class="text-3xl font-bold text-center mb-4">ğŸ“± ç§»åŠ¨ç«¯æ€§èƒ½æµ‹è¯•</h1>
            <p class="text-center text-secondary">éªŒè¯å“åº”å¼è®¾è®¡çš„ç§»åŠ¨ç«¯ä½“éªŒè¯„åˆ†</p>
        </header>

        <!-- è®¾å¤‡ä¿¡æ¯ -->
        <section class="test-section">
            <h2 class="test-title">ğŸ“Š è®¾å¤‡ä¿¡æ¯</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <span class="metric-value" id="screen-size">-</span>
                    <div class="metric-label">å±å¹•å°ºå¯¸</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="device-type">-</span>
                    <div class="metric-label">è®¾å¤‡ç±»å‹</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="pixel-ratio">-</span>
                    <div class="metric-label">åƒç´ æ¯”</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="touch-support">-</span>
                    <div class="metric-label">è§¦æ‘¸æ”¯æŒ</div>
                </div>
            </div>
        </section>

        <!-- æ€§èƒ½æŒ‡æ ‡ -->
        <section class="test-section">
            <h2 class="test-title">âš¡ æ€§èƒ½æŒ‡æ ‡</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <span class="metric-value" id="load-time">-</span>
                    <div class="metric-label">åŠ è½½æ—¶é—´ (ms)</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="fcp-time">-</span>
                    <div class="metric-label">é¦–å±æ¸²æŸ“ (ms)</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="memory-usage">-</span>
                    <div class="metric-label">å†…å­˜ä½¿ç”¨ (MB)</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="fps-count">-</span>
                    <div class="metric-label">å¸§ç‡ (FPS)</div>
                </div>
            </div>
        </section>

        <!-- è§¦æ‘¸å“åº”æµ‹è¯• -->
        <section class="test-section">
            <h2 class="test-title">ğŸ‘† è§¦æ‘¸å“åº”æµ‹è¯•</h2>
            <div class="touch-test-area" id="touch-test">
                <div>ç‚¹å‡»æˆ–è§¦æ‘¸è¿™é‡Œæµ‹è¯•å“åº”æ—¶é—´</div>
                <div class="text-sm text-secondary mt-2">å¹³å‡å“åº”æ—¶é—´: <span id="touch-response-time">0ms</span></div>
            </div>
            <div class="metric-grid">
                <div class="metric-card">
                    <span class="metric-value" id="touch-count">0</span>
                    <div class="metric-label">è§¦æ‘¸æ¬¡æ•°</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="avg-response">0ms</span>
                    <div class="metric-label">å¹³å‡å“åº”</div>
                </div>
            </div>
        </section>

        <!-- æ»šåŠ¨æ€§èƒ½æµ‹è¯• -->
        <section class="test-section">
            <h2 class="test-title">ğŸ“œ æ»šåŠ¨æ€§èƒ½æµ‹è¯•</h2>
            <button class="test-button" onclick="startScrollTest()">å¼€å§‹æ»šåŠ¨æµ‹è¯•</button>
            <div class="progress-bar">
                <div class="progress-fill" id="scroll-progress"></div>
            </div>
            <div class="metric-grid">
                <div class="metric-card">
                    <span class="metric-value" id="scroll-fps">-</span>
                    <div class="metric-label">æ»šåŠ¨å¸§ç‡</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="scroll-smoothness">-</span>
                    <div class="metric-label">æµç•…åº¦è¯„åˆ†</div>
                </div>
            </div>
        </section>

        <!-- ç½‘ç»œçŠ¶æ€ -->
        <section class="test-section">
            <h2 class="test-title">ğŸŒ ç½‘ç»œçŠ¶æ€</h2>
            <div class="metric-grid">
                <div class="metric-card">
                    <span class="metric-value" id="connection-type">-</span>
                    <div class="metric-label">è¿æ¥ç±»å‹</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="effective-type">-</span>
                    <div class="metric-label">æœ‰æ•ˆç±»å‹</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="downlink">-</span>
                    <div class="metric-label">ä¸‹è¡Œé€Ÿåº¦ (Mbps)</div>
                </div>
                <div class="metric-card">
                    <span class="metric-value" id="rtt">-</span>
                    <div class="metric-label">å»¶è¿Ÿ (ms)</div>
                </div>
            </div>
        </section>

        <!-- ç»¼åˆè¯„åˆ† -->
        <section class="test-section">
            <h2 class="test-title">ğŸ¯ ç§»åŠ¨ç«¯ä½“éªŒè¯„åˆ†</h2>
            <div class="text-center">
                <div class="text-6xl font-bold text-primary mb-4" id="overall-score">-</div>
                <div class="text-lg text-secondary mb-4">/ 5.0</div>
                <button class="test-button" onclick="calculateOverallScore()">è®¡ç®—ç»¼åˆè¯„åˆ†</button>
            </div>
            <div class="test-log" id="score-log"></div>
        </section>
    </div>

    <!-- JavaScript -->
    <script src="js/responsive-enhanced.js"></script>
    <!-- ä¸“ä¸šå›¾æ ‡ç³»ç»Ÿ -->
    <script src="/js/icon-system.js"></script>
    <script src="/js/professional-icon-library.js"></script>
    <script src="/js/icon-upgrade-system.js"></script>
    <script>
        class MobilePerformanceTester {
            constructor() {
                this.touchTimes = [];
                this.scrollFrames = [];
                this.testResults = {};
                this.init();
            }

            init() {
                this.updateDeviceInfo();
                this.setupPerformanceMonitoring();
                this.setupTouchTesting();
                this.updateNetworkInfo();
                
                // é¡µé¢åŠ è½½å®Œæˆåæ›´æ–°æ€§èƒ½æŒ‡æ ‡
                window.addEventListener('load', () => {
                    setTimeout(() => this.updatePerformanceMetrics(), 100);
                });
            }

            updateDeviceInfo() {
                document.getElementById('screen-size').textContent = 
                    `${window.innerWidth}Ã—${window.innerHeight}`;
                
                const deviceType = window.innerWidth < 768 ? 'ç§»åŠ¨ç«¯' : 
                                 window.innerWidth < 1024 ? 'å¹³æ¿' : 'æ¡Œé¢';
                document.getElementById('device-type').textContent = deviceType;
                
                document.getElementById('pixel-ratio').textContent = 
                    window.devicePixelRatio || 1;
                
                document.getElementById('touch-support').textContent = 
                    'ontouchstart' in window ? 'æ˜¯' : 'å¦';
            }

            setupPerformanceMonitoring() {
                // FPSç›‘æ§
                let frames = 0;
                let lastTime = performance.now();
                
                const countFPS = () => {
                    frames++;
                    const currentTime = performance.now();
                    
                    if (currentTime >= lastTime + 1000) {
                        document.getElementById('fps-count').textContent = frames;
                        frames = 0;
                        lastTime = currentTime;
                    }
                    
                    requestAnimationFrame(countFPS);
                };
                
                requestAnimationFrame(countFPS);
            }

            updatePerformanceMetrics() {
                // é¡µé¢åŠ è½½æ—¶é—´
                const navigation = performance.getEntriesByType('navigation')[0];
                if (navigation) {
                    const loadTime = Math.round(navigation.loadEventEnd - navigation.loadEventStart);
                    document.getElementById('load-time').textContent = loadTime;
                    this.testResults.loadTime = loadTime;
                }

                // é¦–å±æ¸²æŸ“æ—¶é—´
                const observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.name === 'first-contentful-paint') {
                            const fcpTime = Math.round(entry.startTime);
                            document.getElementById('fcp-time').textContent = fcpTime;
                            this.testResults.fcpTime = fcpTime;
                        }
                    }
                });
                
                try {
                    observer.observe({ entryTypes: ['paint'] });
                } catch (e) {
                    document.getElementById('fcp-time').textContent = 'ä¸æ”¯æŒ';
                }

                // å†…å­˜ä½¿ç”¨
                if (performance.memory) {
                    const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                    document.getElementById('memory-usage').textContent = memoryMB;
                    this.testResults.memoryUsage = memoryMB;
                } else {
                    document.getElementById('memory-usage').textContent = 'ä¸æ”¯æŒ';
                }
            }

            setupTouchTesting() {
                const touchArea = document.getElementById('touch-test');
                let touchStartTime = 0;

                const handleStart = (e) => {
                    touchStartTime = performance.now();
                    touchArea.classList.add('active');
                };

                const handleEnd = (e) => {
                    const responseTime = performance.now() - touchStartTime;
                    this.touchTimes.push(responseTime);
                    
                    touchArea.classList.remove('active');
                    
                    // æ›´æ–°ç»Ÿè®¡
                    document.getElementById('touch-count').textContent = this.touchTimes.length;
                    
                    const avgResponse = this.touchTimes.reduce((a, b) => a + b, 0) / this.touchTimes.length;
                    document.getElementById('avg-response').textContent = Math.round(avgResponse) + 'ms';
                    document.getElementById('touch-response-time').textContent = Math.round(responseTime) + 'ms';
                    
                    this.testResults.avgTouchResponse = avgResponse;
                };

                touchArea.addEventListener('touchstart', handleStart, { passive: true });
                touchArea.addEventListener('touchend', handleEnd, { passive: true });
                touchArea.addEventListener('mousedown', handleStart);
                touchArea.addEventListener('mouseup', handleEnd);
            }

            updateNetworkInfo() {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                
                if (connection) {
                    document.getElementById('connection-type').textContent = 
                        connection.type || 'æœªçŸ¥';
                    document.getElementById('effective-type').textContent = 
                        connection.effectiveType || 'æœªçŸ¥';
                    document.getElementById('downlink').textContent = 
                        connection.downlink || 'æœªçŸ¥';
                    document.getElementById('rtt').textContent = 
                        connection.rtt || 'æœªçŸ¥';
                        
                    this.testResults.networkType = connection.effectiveType;
                } else {
                    document.getElementById('connection-type').textContent = 'ä¸æ”¯æŒ';
                    document.getElementById('effective-type').textContent = 'ä¸æ”¯æŒ';
                    document.getElementById('downlink').textContent = 'ä¸æ”¯æŒ';
                    document.getElementById('rtt').textContent = 'ä¸æ”¯æŒ';
                }
            }

            calculateOverallScore() {
                const log = document.getElementById('score-log');
                log.innerHTML = '';
                
                let totalScore = 0;
                let factors = 0;
                
                const addLog = (message) => {
                    log.innerHTML += message + '\n';
                };

                addLog('ğŸ” å¼€å§‹è®¡ç®—ç§»åŠ¨ç«¯ä½“éªŒè¯„åˆ†...\n');

                // åŠ è½½æ€§èƒ½è¯„åˆ† (25%)
                if (this.testResults.loadTime !== undefined) {
                    let loadScore = 5;
                    if (this.testResults.loadTime > 3000) loadScore = 1;
                    else if (this.testResults.loadTime > 2000) loadScore = 2;
                    else if (this.testResults.loadTime > 1000) loadScore = 3;
                    else if (this.testResults.loadTime > 500) loadScore = 4;
                    
                    totalScore += loadScore * 0.25;
                    factors += 0.25;
                    addLog(`ğŸ“Š åŠ è½½æ€§èƒ½: ${this.testResults.loadTime}ms â†’ ${loadScore}/5 (æƒé‡25%)`);
                }

                // é¦–å±æ¸²æŸ“è¯„åˆ† (20%)
                if (this.testResults.fcpTime !== undefined) {
                    let fcpScore = 5;
                    if (this.testResults.fcpTime > 4000) fcpScore = 1;
                    else if (this.testResults.fcpTime > 2500) fcpScore = 2;
                    else if (this.testResults.fcpTime > 1500) fcpScore = 3;
                    else if (this.testResults.fcpTime > 800) fcpScore = 4;
                    
                    totalScore += fcpScore * 0.20;
                    factors += 0.20;
                    addLog(`ğŸ¨ é¦–å±æ¸²æŸ“: ${this.testResults.fcpTime}ms â†’ ${fcpScore}/5 (æƒé‡20%)`);
                }

                // è§¦æ‘¸å“åº”è¯„åˆ† (25%)
                if (this.testResults.avgTouchResponse !== undefined) {
                    let touchScore = 5;
                    if (this.testResults.avgTouchResponse > 200) touchScore = 1;
                    else if (this.testResults.avgTouchResponse > 150) touchScore = 2;
                    else if (this.testResults.avgTouchResponse > 100) touchScore = 3;
                    else if (this.testResults.avgTouchResponse > 50) touchScore = 4;
                    
                    totalScore += touchScore * 0.25;
                    factors += 0.25;
                    addLog(`ğŸ‘† è§¦æ‘¸å“åº”: ${Math.round(this.testResults.avgTouchResponse)}ms â†’ ${touchScore}/5 (æƒé‡25%)`);
                }

                // å†…å­˜ä½¿ç”¨è¯„åˆ† (15%)
                if (this.testResults.memoryUsage !== undefined) {
                    let memoryScore = 5;
                    if (this.testResults.memoryUsage > 100) memoryScore = 1;
                    else if (this.testResults.memoryUsage > 75) memoryScore = 2;
                    else if (this.testResults.memoryUsage > 50) memoryScore = 3;
                    else if (this.testResults.memoryUsage > 25) memoryScore = 4;
                    
                    totalScore += memoryScore * 0.15;
                    factors += 0.15;
                    addLog(`ğŸ’¾ å†…å­˜ä½¿ç”¨: ${this.testResults.memoryUsage}MB â†’ ${memoryScore}/5 (æƒé‡15%)`);
                }

                // ç½‘ç»œé€‚é…è¯„åˆ† (15%)
                if (this.testResults.networkType) {
                    let networkScore = 5;
                    if (this.testResults.networkType === 'slow-2g') networkScore = 2;
                    else if (this.testResults.networkType === '2g') networkScore = 3;
                    else if (this.testResults.networkType === '3g') networkScore = 4;
                    
                    totalScore += networkScore * 0.15;
                    factors += 0.15;
                    addLog(`ğŸŒ ç½‘ç»œé€‚é…: ${this.testResults.networkType} â†’ ${networkScore}/5 (æƒé‡15%)`);
                }

                const finalScore = factors > 0 ? totalScore / factors * 5 : 0;
                
                addLog(`\nğŸ¯ ç»¼åˆè¯„åˆ†è®¡ç®—:`);
                addLog(`   æ€»åˆ†: ${totalScore.toFixed(2)}`);
                addLog(`   æƒé‡: ${factors.toFixed(2)}`);
                addLog(`   æœ€ç»ˆè¯„åˆ†: ${finalScore.toFixed(2)}/5`);
                
                if (finalScore >= 4.5) {
                    addLog(`\nâœ… ä¼˜ç§€ï¼ç§»åŠ¨ç«¯ä½“éªŒè¯„åˆ†è¾¾åˆ°ç›®æ ‡ (â‰¥4.5/5)`);
                } else if (finalScore >= 4.0) {
                    addLog(`\nâš ï¸  è‰¯å¥½ï¼Œä½†ä»æœ‰ä¼˜åŒ–ç©ºé—´`);
                } else {
                    addLog(`\nâŒ éœ€è¦ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ`);
                }

                document.getElementById('overall-score').textContent = finalScore.toFixed(2);
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                log.scrollTop = log.scrollHeight;
            }
        }

        // æ»šåŠ¨æµ‹è¯•å‡½æ•°
        function startScrollTest() {
            const progressBar = document.getElementById('scroll-progress');
            const scrollFpsElement = document.getElementById('scroll-fps');
            const smoothnessElement = document.getElementById('scroll-smoothness');
            
            let frames = 0;
            let startTime = performance.now();
            let lastFrameTime = startTime;
            let frameDeltas = [];
            
            const testDuration = 3000; // 3ç§’æµ‹è¯•
            
            const animateScroll = () => {
                const currentTime = performance.now();
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / testDuration, 1) * 100;
                
                progressBar.style.width = progress + '%';
                
                // è®¡ç®—å¸§ç‡
                frames++;
                const frameDelta = currentTime - lastFrameTime;
                frameDeltas.push(frameDelta);
                lastFrameTime = currentTime;
                
                if (elapsed < testDuration) {
                    requestAnimationFrame(animateScroll);
                } else {
                    // æµ‹è¯•å®Œæˆï¼Œè®¡ç®—ç»“æœ
                    const avgFps = Math.round(frames / (testDuration / 1000));
                    const avgFrameDelta = frameDeltas.reduce((a, b) => a + b, 0) / frameDeltas.length;
                    const smoothness = Math.max(0, Math.min(100, 100 - (avgFrameDelta - 16.67) * 2));
                    
                    scrollFpsElement.textContent = avgFps;
                    smoothnessElement.textContent = Math.round(smoothness) + '%';
                }
            };
            
            requestAnimationFrame(animateScroll);
        }

        // åˆå§‹åŒ–æµ‹è¯•å™¨
        const tester = new MobilePerformanceTester();
        
        // çª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°è®¾å¤‡ä¿¡æ¯
        window.addEventListener('resize', () => {
            tester.updateDeviceInfo();
        });
    </script>
</body>
</html>