<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图标升级系统测试 - Lawsker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🔧</text></svg>">
    
    <!-- 设计系统样式 -->
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="stylesheet" href="/css/components.css">
    
    <!-- 图标系统 -->
    <script src="/js/icon-system.js"></script>
    <script src="/js/professional-icon-library.js"></script>
    <script src="/js/icon-upgrade-system.js"></script>
    
    <style>
        body {
            font-family: var(--font-family-sans);
            background: var(--bg-secondary);
            margin: 0;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
        }
        
        .title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-200);
            padding-bottom: 0.5rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .test-item {
            padding: 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: var(--gray-50);
        }
        
        .test-item h4 {
            margin: 0 0 1rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .emoji-test {
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .button-test {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .test-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .test-btn:hover {
            background: var(--primary-50);
            border-color: var(--primary-300);
        }
        
        .icon-list {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .icon-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            background: white;
            font-size: 0.875rem;
        }
        
        .stats-display {
            background: var(--primary-50);
            border: 1px solid var(--primary-200);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-600);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .code-example {
            background: var(--gray-900);
            color: var(--gray-100);
            padding: 1rem;
            border-radius: 6px;
            font-family: var(--font-family-mono);
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .upgrade-log {
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            padding: 1rem;
            font-family: var(--font-family-mono);
            font-size: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        
        .control-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .control-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--primary-600);
            border-radius: 6px;
            background: var(--primary-600);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .control-btn:hover {
            background: var(--primary-700);
        }
        
        .control-btn.secondary {
            background: white;
            color: var(--primary-600);
        }
        
        .control-btn.secondary:hover {
            background: var(--primary-50);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 页面头部 -->
        <div class="header">
            <h1 class="title">🔧 图标升级系统测试</h1>
            <p class="subtitle">测试专业图标系统的自动升级功能和效果</p>
        </div>
        
        <!-- 控制面板 -->
        <div class="control-panel">
            <button class="control-btn" onclick="runUpgradeTest()">运行升级测试</button>
            <button class="control-btn secondary" onclick="showStats()">显示统计</button>
            <button class="control-btn secondary" onclick="clearLog()">清除日志</button>
            <button class="control-btn secondary" onclick="addDynamicContent()">添加动态内容</button>
        </div>
        
        <!-- 统计信息 -->
        <div class="test-section">
            <h3 class="section-title">系统统计</h3>
            <div class="stats-display">
                <div class="stats-grid" id="stats-grid">
                    <!-- 统计数据将在这里显示 -->
                </div>
            </div>
        </div>
        
        <!-- Emoji图标测试 -->
        <div class="test-section">
            <h3 class="section-title">Emoji 图标升级测试</h3>
            <div class="test-grid">
                <div class="test-item">
                    <h4>用户相关</h4>
                    <div class="emoji-test">👤 用户 👥 用户组 👨‍💼 律师</div>
                </div>
                
                <div class="test-item">
                    <h4>法律相关</h4>
                    <div class="emoji-test">⚖️ 法律 📄 文档 💼 公文包</div>
                </div>
                
                <div class="test-item">
                    <h4>金融支付</h4>
                    <div class="emoji-test">💳 信用卡 💰 金钱 💵 美元</div>
                </div>
                
                <div class="test-item">
                    <h4>成就游戏</h4>
                    <div class="emoji-test">🏆 奖杯 ⭐ 星星 🔥 火焰</div>
                </div>
            </div>
        </div>
        
        <!-- 按钮图标测试 -->
        <div class="test-section">
            <h3 class="section-title">按钮图标测试</h3>
            <div class="test-grid">
                <div class="test-item">
                    <h4>导航按钮</h4>
                    <div class="button-test">
                        <button class="test-btn">🏠 首页</button>
                        <button class="test-btn">⚙️ 设置</button>
                        <button class="test-btn">🔔 通知</button>
                        <button class="test-btn">📊 统计</button>
                    </div>
                </div>
                
                <div class="test-item">
                    <h4>操作按钮</h4>
                    <div class="button-test">
                        <button class="test-btn">➕ 添加</button>
                        <button class="test-btn">➖ 删除</button>
                        <button class="test-btn">✅ 确认</button>
                        <button class="test-btn">❌ 取消</button>
                    </div>
                </div>
                
                <div class="test-item">
                    <h4>业务按钮</h4>
                    <div class="button-test">
                        <button class="test-btn">⚖️ 法律服务</button>
                        <button class="test-btn">💳 支付管理</button>
                        <button class="test-btn">🏆 成就中心</button>
                        <button class="test-btn">📧 消息中心</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Data属性图标测试 -->
        <div class="test-section">
            <h3 class="section-title">Data 属性图标测试</h3>
            <div class="test-grid">
                <div class="test-item">
                    <h4>基础图标</h4>
                    <div class="icon-list">
                        <div class="icon-item">
                            <span data-icon="user" data-icon-size="20"></span>
                            用户
                        </div>
                        <div class="icon-item">
                            <span data-icon="scale" data-icon-size="20"></span>
                            法律
                        </div>
                        <div class="icon-item">
                            <span data-icon="trophy" data-icon-size="20"></span>
                            成就
                        </div>
                    </div>
                </div>
                
                <div class="test-item">
                    <h4>扩展图标</h4>
                    <div class="icon-list">
                        <div class="icon-item">
                            <span data-icon="gavel" data-icon-size="20"></span>
                            法槌
                        </div>
                        <div class="icon-item">
                            <span data-icon="analytics" data-icon-size="20"></span>
                            分析
                        </div>
                        <div class="icon-item">
                            <span data-icon="workflow" data-icon-size="20"></span>
                            流程
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 上下文图标测试 -->
        <div class="test-section">
            <h3 class="section-title">上下文智能图标测试</h3>
            <div class="test-grid">
                <div class="test-item">
                    <h4>登录相关</h4>
                    <div class="button-test">
                        <button class="test-btn">login</button>
                        <button class="test-btn">register</button>
                        <button class="test-btn">profile</button>
                    </div>
                </div>
                
                <div class="test-item">
                    <h4>业务相关</h4>
                    <div class="button-test">
                        <button class="test-btn">lawyer</button>
                        <button class="test-btn">case</button>
                        <button class="test-btn">payment</button>
                    </div>
                </div>
                
                <div class="test-item">
                    <h4>状态相关</h4>
                    <div class="button-test">
                        <button class="test-btn">success</button>
                        <button class="test-btn">error</button>
                        <button class="test-btn">warning</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 升级日志 -->
        <div class="test-section">
            <h3 class="section-title">升级日志</h3>
            <div class="upgrade-log" id="upgrade-log">
                等待升级测试...
            </div>
        </div>
        
        <!-- 使用示例 -->
        <div class="test-section">
            <h3 class="section-title">代码示例</h3>
            <div class="code-example">
// 手动升级元素
window.IconUpgradeSystem.upgradeElement(document.querySelector('.my-element'));

// 获取升级统计
const stats = window.IconUpgradeSystem.getUpgradeStats();
console.log('已升级图标数量:', stats.totalUpgraded);

// 搜索图标
const results = window.ProfessionalIconLibrary.searchIcons('legal');

// 按分类获取图标
const legalIcons = window.ProfessionalIconLibrary.getIconsByCategory('legal');

// 创建图标选择器
window.ProfessionalIconLibrary.createIconPicker(container, {
  onSelect: (iconName, iconSvg) => {
    console.log('选择了图标:', iconName);
  }
});
            </div>
        </div>
    </div>

    <script>
        let logContainer;
        
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('upgrade-log');
            
            // 初始化统计显示
            setTimeout(() => {
                showStats();
                logMessage('✅ 图标系统初始化完成');
            }, 500);
            
            // 监听升级事件
            if (window.IconUpgradeSystem) {
                const originalPerformUpgrade = window.IconUpgradeSystem.performUpgrade;
                window.IconUpgradeSystem.performUpgrade = function() {
                    logMessage('🔄 开始执行图标升级...');
                    const result = originalPerformUpgrade.call(this);
                    const stats = this.getUpgradeStats();
                    logMessage(`✅ 升级完成，共升级 ${stats.totalUpgraded} 个图标`);
                    showStats();
                    return result;
                };
            }
        });
        
        function logMessage(message) {
            if (logContainer) {
                const timestamp = new Date().toLocaleTimeString();
                logContainer.innerHTML += `[${timestamp}] ${message}\n`;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }
        
        function runUpgradeTest() {
            logMessage('🚀 开始运行升级测试...');
            
            if (window.IconUpgradeSystem) {
                window.IconUpgradeSystem.performUpgrade();
            } else {
                logMessage('❌ IconUpgradeSystem 未找到');
            }
        }
        
        function showStats() {
            const statsGrid = document.getElementById('stats-grid');
            if (!statsGrid) return;
            
            let stats = {};
            
            // 获取图标系统统计
            if (window.IconSystem) {
                stats.totalIcons = window.IconSystem.getAvailableIcons().length;
            }
            
            // 获取专业图标库统计
            if (window.ProfessionalIconLibrary) {
                const libStats = window.ProfessionalIconLibrary.getStats();
                Object.assign(stats, libStats);
            }
            
            // 获取升级系统统计
            if (window.IconUpgradeSystem) {
                const upgradeStats = window.IconUpgradeSystem.getUpgradeStats();
                Object.assign(stats, upgradeStats);
            }
            
            // 显示统计
            statsGrid.innerHTML = Object.entries(stats).map(([key, value]) => `
                <div class="stat-item">
                    <div class="stat-number">${value}</div>
                    <div class="stat-label">${getStatLabel(key)}</div>
                </div>
            `).join('');
            
            logMessage(`📊 统计更新: ${JSON.stringify(stats)}`);
        }
        
        function getStatLabel(key) {
            const labels = {
                totalIcons: '总图标数',
                extendedIcons: '扩展图标',
                categories: '分类数量',
                categorizedIcons: '已分类图标',
                totalUpgraded: '已升级图标',
                availableIcons: '可用图标',
                mappings: '映射规则'
            };
            return labels[key] || key;
        }
        
        function clearLog() {
            if (logContainer) {
                logContainer.innerHTML = '';
                logMessage('🧹 日志已清除');
            }
        }
        
        function addDynamicContent() {
            logMessage('➕ 添加动态内容测试...');
            
            const container = document.querySelector('.test-section:last-of-type');
            const dynamicDiv = document.createElement('div');
            dynamicDiv.className = 'test-item';
            dynamicDiv.innerHTML = `
                <h4>动态添加的内容</h4>
                <div class="button-test">
                    <button class="test-btn">🆕 新按钮</button>
                    <button class="test-btn">📱 移动端</button>
                    <button class="test-btn">💻 桌面端</button>
                </div>
                <div class="icon-list">
                    <div class="icon-item">
                        <span data-icon="smartphone" data-icon-size="20"></span>
                        手机
                    </div>
                    <div class="icon-item">
                        <span data-icon="computer-desktop" data-icon-size="20"></span>
                        电脑
                    </div>
                </div>
            `;
            
            container.appendChild(dynamicDiv);
            
            // 手动升级新添加的内容
            if (window.IconUpgradeSystem) {
                window.IconUpgradeSystem.upgradeElement(dynamicDiv);
            }
            
            logMessage('✅ 动态内容添加完成并已升级');
        }
        
        // 测试图标选择器
        function showIconPicker() {
            const pickerContainer = document.createElement('div');
            pickerContainer.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 1000;
                background: white;
                border-radius: 12px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                padding: 20px;
                max-width: 90vw;
                max-height: 90vh;
            `;
            
            document.body.appendChild(pickerContainer);
            
            if (window.ProfessionalIconLibrary) {
                window.ProfessionalIconLibrary.createIconPicker(pickerContainer, {
                    onSelect: (iconName, iconSvg) => {
                        logMessage(`🎯 选择了图标: ${iconName}`);
                        document.body.removeChild(pickerContainer);
                    }
                });
            }
            
            // 添加关闭按钮
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '关闭';
            closeBtn.style.cssText = 'position: absolute; top: 10px; right: 10px; padding: 5px 10px;';
            closeBtn.onclick = () => document.body.removeChild(pickerContainer);
            pickerContainer.appendChild(closeBtn);
        }
    </script>
</body>
</html>