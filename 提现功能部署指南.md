# ğŸ’° WithdrawalRequestsæç°åŠŸèƒ½éƒ¨ç½²æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

WithdrawalRequestsæç°åŠŸèƒ½æ˜¯Lawskerç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ç°äº†ï¼š

- **ç”¨æˆ·æç°ç”³è¯·**ï¼šç”¨æˆ·å¯ä»¥ç”³è¯·å°†è™šæ‹Ÿä½™é¢æå–åˆ°é“¶è¡Œè´¦æˆ·
- **è‡ªåŠ¨é£é™©è¯„ä¼°**ï¼šç³»ç»Ÿè‡ªåŠ¨è®¡ç®—é£é™©è¯„åˆ†ï¼Œä½é£é™©è‡ªåŠ¨å®¡æ‰¹
- **ç®¡ç†å‘˜å®¡æ ¸**ï¼šé«˜é£é™©æç°éœ€è¦ç®¡ç†å‘˜äººå·¥å®¡æ ¸
- **æ‰‹ç»­è´¹è®¡ç®—**ï¼šåŸºäºé‡‘é¢æ¢¯åº¦çš„æ‰‹ç»­è´¹ä½“ç³»
- **é“¶è¡Œå¡éªŒè¯**ï¼šæ”¯æŒä¸»æµé“¶è¡Œå¡å·æ ¼å¼éªŒè¯
- **çŠ¶æ€è·Ÿè¸ª**ï¼šå®Œæ•´çš„æç°çŠ¶æ€æµè½¬å’Œæ—¶é—´è®°å½•

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ•°æ®åº“è¿ç§»

é¦–å…ˆæ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼š

```bash
# è¿æ¥åˆ°PostgreSQLæ•°æ®åº“
psql -h localhost -U your_username -d lawsker

# æ‰§è¡Œè¿ç§»è„šæœ¬
\i backend/migrations/add_withdrawal_request_table.sql
```

æˆ–è€…ç›´æ¥æ‰§è¡ŒSQLæ–‡ä»¶ï¼š

```bash
psql -h localhost -U your_username -d lawsker -f backend/migrations/add_withdrawal_request_table.sql
```

### 2. æµ‹è¯•ç³»ç»Ÿå®Œæ•´æ€§

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
cd backend
python test_withdrawal_system.py
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
source venv/bin/activate  # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. è®¿é—®å‰ç«¯ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®æç°ç®¡ç†ç•Œé¢ï¼š
- æœ¬åœ°å¼€å‘ï¼š`http://localhost:6060/withdrawal.html`
- ç”Ÿäº§ç¯å¢ƒï¼š`https://your-domain.com/withdrawal.html`

## ğŸ“Š æ•°æ®åº“ç»“æ„

### withdrawal_requests è¡¨ç»“æ„

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | UUID | ä¸»é”® |
| request_number | VARCHAR(32) | æç°ç”³è¯·å•å· |
| user_id | UUID | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| tenant_id | UUID | ç§Ÿæˆ·IDï¼ˆå¤–é”®ï¼‰ |
| amount | DECIMAL(15,2) | ç”³è¯·é‡‘é¢ |
| fee | DECIMAL(15,2) | æ‰‹ç»­è´¹ |
| actual_amount | DECIMAL(15,2) | å®é™…åˆ°è´¦é‡‘é¢ |
| bank_account | VARCHAR(32) | é“¶è¡Œå¡å· |
| bank_name | VARCHAR(100) | å¼€æˆ·é“¶è¡Œ |
| account_holder | VARCHAR(100) | æŒå¡äººå§“å |
| status | withdrawal_status | æç°çŠ¶æ€ |
| risk_score | DECIMAL(5,2) | é£é™©è¯„åˆ† |
| auto_approved | BOOLEAN | æ˜¯å¦è‡ªåŠ¨å®¡æ‰¹ |
| admin_id | UUID | å®¡æ ¸ç®¡ç†å‘˜ID |
| admin_notes | TEXT | ç®¡ç†å‘˜å¤‡æ³¨ |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ |
| processed_at | TIMESTAMP | å¤„ç†æ—¶é—´ |
| metadata | JSONB | æ‰©å±•å…ƒæ•°æ® |

### çŠ¶æ€æšä¸¾å€¼

- `pending`: å¾…å®¡æ ¸
- `approved`: å·²æ‰¹å‡†
- `processing`: å¤„ç†ä¸­
- `completed`: å·²å®Œæˆ
- `rejected`: å·²æ‹’ç»
- `failed`: å¤±è´¥
- `cancelled`: å·²å–æ¶ˆ

## ğŸ”§ APIç«¯ç‚¹åˆ—è¡¨

### ç”¨æˆ·ç«¯API

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/v1/finance/wallet` | GET | è·å–é’±åŒ…ä¿¡æ¯ |
| `/api/v1/finance/withdrawal/create` | POST | åˆ›å»ºæç°ç”³è¯· |
| `/api/v1/finance/withdrawal/list` | GET | è·å–ç”¨æˆ·æç°è®°å½• |

### ç®¡ç†å‘˜API

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/v1/finance/withdrawal/admin/list` | GET | è·å–æ‰€æœ‰æç°ç”³è¯· |
| `/api/v1/finance/withdrawal/admin/{id}/approve` | POST | å®¡æ‰¹é€šè¿‡ |
| `/api/v1/finance/withdrawal/admin/{id}/reject` | POST | å®¡æ‰¹æ‹’ç» |

## ğŸ’¼ ä¸šåŠ¡è§„åˆ™

### æç°é™åˆ¶

- **æœ€å°é‡‘é¢**ï¼šÂ¥10
- **æœ€å¤§å•æ¬¡é‡‘é¢**ï¼šÂ¥50,000
- **æ¯æ—¥é™é¢**ï¼šÂ¥100,000
- **å¤„ç†æ—¶é—´**ï¼š1-3ä¸ªå·¥ä½œæ—¥

### æ‰‹ç»­è´¹è®¡ç®—

```python
def calculate_fee(amount):
    if amount <= 1000:
        return amount * 0.01      # 1%
    elif amount <= 5000:
        return amount * 0.005     # 0.5%
    else:
        return amount * 0.001     # 0.1%
```

### é£é™©è¯„ä¼°

ç³»ç»Ÿæ ¹æ®ä»¥ä¸‹å› ç´ è®¡ç®—é£é™©è¯„åˆ†ï¼ˆ0-100ï¼‰ï¼š

- **ç”¨æˆ·å†å²è®°å½•**ï¼šæç°é¢‘ç‡ã€æˆåŠŸç‡
- **é‡‘é¢å¤§å°**ï¼šå¤§é¢æç°é£é™©è¾ƒé«˜
- **è´¦æˆ·ä¿¡æ¯**ï¼šé“¶è¡Œå¡ä¸ç”¨æˆ·ä¿¡æ¯åŒ¹é…åº¦
- **æ—¶é—´æ¨¡å¼**ï¼šå¼‚å¸¸æ—¶é—´æ®µçš„æç°

é£é™©è¯„åˆ† < 30 è‡ªåŠ¨å®¡æ‰¹ï¼Œâ‰¥ 30 éœ€è¦äººå·¥å®¡æ ¸ã€‚

### é“¶è¡Œå¡éªŒè¯

- æ”¯æŒ16-19ä½é“¶è¡Œå¡å·
- çº¯æ•°å­—æ ¼å¼
- æ”¯æŒä¸»æµé“¶è¡Œï¼ˆå·¥å•†ã€å»ºè®¾ã€å†œä¸šã€ä¸­å›½é“¶è¡Œç­‰ï¼‰

## ğŸ–¥ï¸ å‰ç«¯åŠŸèƒ½

### ç”¨æˆ·ç•Œé¢åŠŸèƒ½

1. **é’±åŒ…æ¦‚è§ˆ**
   - è´¦æˆ·ä½™é¢æ˜¾ç¤º
   - å¯æç°ä½™é¢
   - å†»ç»“é‡‘é¢
   - ç´¯è®¡æ”¶å…¥

2. **æç°ç”³è¯·**
   - é‡‘é¢è¾“å…¥å’ŒéªŒè¯
   - é“¶è¡Œä¿¡æ¯å¡«å†™
   - å®æ—¶æ‰‹ç»­è´¹è®¡ç®—
   - ä¸€é”®æäº¤ç”³è¯·

3. **æç°è®°å½•**
   - å†å²æç°è®°å½•æŸ¥çœ‹
   - çŠ¶æ€ç­›é€‰å’Œåˆ†é¡µ
   - è¯¦ç»†ä¿¡æ¯å±•ç¤º

### ç®¡ç†å‘˜ç•Œé¢åŠŸèƒ½

1. **å®¡æ ¸åˆ—è¡¨**
   - æ‰€æœ‰ç”¨æˆ·æç°ç”³è¯·
   - çŠ¶æ€ç­›é€‰å’Œæœç´¢
   - é£é™©è¯„åˆ†æ˜¾ç¤º

2. **å®¡æ ¸æ“ä½œ**
   - æ‰¹å‡†/æ‹’ç»æ“ä½œ
   - å®¡æ ¸å¤‡æ³¨å¡«å†™
   - ä¸€é”®å¤„ç†åŠŸèƒ½

## ğŸ” å®‰å…¨ç‰¹æ€§

### æƒé™æ§åˆ¶

- **ç”¨æˆ·æƒé™**ï¼šåªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„æç°ç”³è¯·
- **ç®¡ç†å‘˜æƒé™**ï¼šå¯ä»¥æŸ¥çœ‹å’Œå®¡æ ¸æ‰€æœ‰æç°ç”³è¯·
- **APIè®¤è¯**ï¼šBearer Tokenè®¤è¯æœºåˆ¶

### æ•°æ®å®‰å…¨

- **æ•æ„Ÿä¿¡æ¯åŠ å¯†**ï¼šé“¶è¡Œå¡å·éƒ¨åˆ†æ©ç æ˜¾ç¤º
- **æ“ä½œæ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œå®¡è®¡æ—¥å¿—
- **é£é™©æ§åˆ¶**ï¼šè‡ªåŠ¨é£é™©è¯„ä¼°å’Œäººå·¥å®¡æ ¸

### é˜²æŠ¤æœºåˆ¶

- **é¢‘ç‡é™åˆ¶**ï¼šé˜²æ­¢æ¶æ„å¤§é‡ç”³è¯·
- **é‡‘é¢éªŒè¯**ï¼šä¸¥æ ¼çš„é‡‘é¢èŒƒå›´æ£€æŸ¥
- **çŠ¶æ€æ£€æŸ¥**ï¼šé˜²æ­¢é‡å¤å¤„ç†

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…

å‰ç«¯ç•Œé¢å®Œå…¨æ”¯æŒç§»åŠ¨è®¾å¤‡ï¼š

- **å“åº”å¼è®¾è®¡**ï¼šè‡ªé€‚åº”å„ç§å±å¹•å°ºå¯¸
- **è§¦æ‘¸ä¼˜åŒ–**ï¼šé€‚åˆç§»åŠ¨è®¾å¤‡æ“ä½œ
- **iOSå…¼å®¹**ï¼šæ”¯æŒSafe Areaå’ŒPWAç‰¹æ€§

## ğŸ”„ é›†æˆè¯´æ˜

### ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

1. **é’±åŒ…ç³»ç»Ÿ**ï¼šè¯»å–ç”¨æˆ·å¯æç°ä½™é¢
2. **ç”¨æˆ·ç³»ç»Ÿ**ï¼šéªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™
3. **æ”¯ä»˜ç³»ç»Ÿ**ï¼šæ‰§è¡Œå®é™…é“¶è¡Œè½¬è´¦
4. **é€šçŸ¥ç³»ç»Ÿ**ï¼šå‘é€æç°çŠ¶æ€å˜æ›´é€šçŸ¥

### æ‰©å±•æ¥å£

- **ç¬¬ä¸‰æ–¹é“¶è¡ŒAPI**ï¼šå®é™…è½¬è´¦æ‰§è¡Œ
- **é£æ§ç³»ç»Ÿ**ï¼šæ›´å¤æ‚çš„é£é™©è¯„ä¼°
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šå¼‚æ­¥å¤„ç†å¤§é‡æç°è¯·æ±‚

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
   - éªŒè¯æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   - ç¡®è®¤ç”¨æˆ·æƒé™

2. **è¡¨ä¸å­˜åœ¨é”™è¯¯**
   - æ‰§è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
   - æ£€æŸ¥è¡¨ç»“æ„æ˜¯å¦å®Œæ•´
   - éªŒè¯å¤–é”®å…³ç³»

3. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥JWT Tokenæœ‰æ•ˆæ€§
   - éªŒè¯APIç«¯ç‚¹æ˜¯å¦æ­£ç¡®æ³¨å†Œ
   - æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

4. **å‰ç«¯ç•Œé¢å¼‚å¸¸**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯APIå“åº”æ ¼å¼
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—
tail -f backend/logs/app.log

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
tail -f /var/log/postgresql/postgresql.log

# æŸ¥çœ‹NGINXæ—¥å¿—
tail -f /var/log/nginx/access.log
```

## ğŸ“‹ ä¸Šçº¿æ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] æµ‹è¯•è„šæœ¬è¿è¡Œé€šè¿‡
- [ ] APIç«¯ç‚¹å“åº”æ­£å¸¸
- [ ] å‰ç«¯ç•Œé¢åŠŸèƒ½å®Œæ•´
- [ ] æƒé™æ§åˆ¶éªŒè¯é€šè¿‡
- [ ] ä¸šåŠ¡è§„åˆ™æµ‹è¯•å®Œæˆ
- [ ] å®‰å…¨æœºåˆ¶æ£€æŸ¥å®Œæ¯•
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç›‘æ§å’Œå‘Šè­¦é…ç½®
- [ ] å¤‡ä»½ç­–ç•¥ç¡®è®¤

## ğŸ”„ ç»´æŠ¤å’Œç›‘æ§

### æ€§èƒ½ç›‘æ§

- **APIå“åº”æ—¶é—´**ï¼šå…³é”®æ¥å£å“åº”æ—¶é—´ç›‘æ§
- **æ•°æ®åº“æ€§èƒ½**ï¼šæŸ¥è¯¢æ‰§è¡Œæ—¶é—´å’Œç´¢å¼•ä½¿ç”¨ç‡
- **æç°æˆåŠŸç‡**ï¼šä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

### ä¸šåŠ¡ç›‘æ§

- **æ¯æ—¥æç°é‡‘é¢**ï¼šèµ„é‡‘æµé‡ç»Ÿè®¡
- **å®¡æ ¸æ•ˆç‡**ï¼šäººå·¥å®¡æ ¸å¤„ç†æ—¶é—´
- **é£é™©å‘Šè­¦**ï¼šå¼‚å¸¸æç°æ¨¡å¼æ£€æµ‹

### å®šæœŸç»´æŠ¤

- **æ•°æ®å¤‡ä»½**ï¼šæ¯æ—¥è‡ªåŠ¨å¤‡ä»½æç°æ•°æ®
- **æ—¥å¿—æ¸…ç†**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—æ–‡ä»¶
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç´¢å¼•ä¼˜åŒ–å’ŒæŸ¥è¯¢è°ƒä¼˜

---

**ğŸ‰ æ­å–œï¼WithdrawalRequestsæç°åŠŸèƒ½ç°å·²å®Œå…¨å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨ï¼**

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ•…éšœæ’é™¤éƒ¨åˆ†æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚ 